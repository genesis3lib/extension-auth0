{{=<% %>=}}import { Auth0Provider as Auth0ProviderSDK, AppState } from '@auth0/auth0-react';
import type { ReactNode } from 'react';
import { useNavigate } from 'react-router-dom';

interface Auth0ProviderProps {
  children: ReactNode;
}

/**
 * Auth0 Authentication Provider
 * Wraps the application with Auth0 authentication context
 * Handles post-login redirect to originally requested URL
 *
 * Configuration via environment variables:
 * - VITE_AUTH0_DOMAIN: Your Auth0 domain
 * - VITE_AUTH0_CLIENT_ID: Your Auth0 application client ID
 * - VITE_AUTH0_AUDIENCE: Your API audience/identifier
 */
export function Auth0Provider({ children }: Auth0ProviderProps) {
  const navigate = useNavigate();
  const domain = import.meta.env.VITE_AUTH0_DOMAIN;
  const clientId = import.meta.env.VITE_AUTH0_CLIENT_ID;
  const audience = import.meta.env.VITE_AUTH0_AUDIENCE;

  if (!domain || !clientId) {
    console.error('Auth0 configuration missing. Please set VITE_AUTH0_DOMAIN and VITE_AUTH0_CLIENT_ID');
    return <>{children}</>;
  }

  const onRedirectCallback = (appState?: AppState) => {
    // Redirect to originally requested URL or home page
    navigate(appState?.returnTo || window.location.pathname);
  };

  return (
    <Auth0ProviderSDK
      domain={domain}
      clientId={clientId}
      authorizationParams={{
        redirect_uri: window.location.origin,
        ...(audience && { audience })
      }}
      onRedirectCallback={onRedirectCallback}
    >
      {children}
    </Auth0ProviderSDK>
  );
}
<%={{ }}=%>